"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.isRegexVulnerable = void 0;
function isRegexVulnerable(node) {
    const nodeTokens = node.tokens;
    let nodeInstance = null;
    let detect = false;
    const testStrings = [
        "john.doe@example.com", "jane_smith123@example.co.uk", "user-name@example.org", "info@example.com", "test+123@example.net", "john_doe@example.co.in", "hello world",
        "hellohello", "abc abc abc abc", "123 123", "hello hello hello", "wordword word", "b", "bb", "bbb", "bbbb", "bbbbb", "bbbbbb", "aaaaaA",
        "aaaAA", "aaaaaaaaaaaZ", "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaB", "aA", "a", "hello", "world", "regex", "test123", "aA", "ABCDEFG"
    ];
    let startTime = BigInt(9007199254740991);
    for (let node of nodeTokens) {
        if (node.type === "RegularExpression") {
            // console.log(node);
            try {
                // Attempt to create a RegExp object to detect ReDoS-prone patterns
                const regex = new RegExp(node.value);
                startTime = process.hrtime.bigint();
                for (const testString of testStrings) {
                    regex.test(testString);
                }
            }
            catch (error) {
                // If an error occurs during RegExp creation, it might be ReDoS-prone
                nodeInstance = node.loc.start.line;
                detect = true;
            }
        }
        const endTime = process.hrtime.bigint();
        const executionTime = Number(Number(endTime) - Number(startTime)) / 1e6; // Convert nanoseconds to milliseconds
        // Set a threshold value
        const threshold = 0.1; // 100 milliseconds
        // If the execution time exceeds the threshold, consider it a potential ReDoS vulnerability
        if (executionTime > threshold) {
            nodeInstance = node.loc.start.line;
            detect = true;
        }
    }
    if (detect) {
        const output = "==> RegExp object detected with ReDoS-prone patterns at line " + nodeInstance;
        console.log(output.red);
        return;
    }
    console.log("==> NO RegExp object detected with ReDoS-prone patterns".green);
}
exports.isRegexVulnerable = isRegexVulnerable;
